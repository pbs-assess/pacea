---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- build_readme() will build this when developing, but installs pacea from -->
<!-- scratch (and it might not be the local version) so it's much quicker to do -->
<!-- rmarkdown::render("README.Rmd"), which also builds an .html that can be -->
<!-- viewed locally (and isn't pushed to GitHub)  -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "60%"
  )
library(ggplot2)    # TODO needed for harbour_seals plot - look into
```

# pacea

<!-- badges: start -->
[![R-CMD-check](https://github.com/pbs-assess/pacea/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/pbs-assess/pacea/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/pbs-assess/pacea/branch/main/graph/badge.svg)](https://app.codecov.io/gh/pbs-assess/pacea?branch=main)
<!-- badges: end -->

An R package to house Pacific Region ecosystem data to help operationalise an ecosystem approach to fisheries management.

*We wrangle the data so you don't have to*

pacea stands for PACific Ecosystem Approach.

pacea is a data platform containing a variety of data
sets. We wrangle the data sets behind the scenes to get them into usable formats
in R, and provide helpful plotting functions. All data sets include
documentation regarding the original authors, who should be cited as
appropriate.

Under development -- feel free to install and get using, but be aware that
code may change. We will officially release it in October 2023, after which we
will ensure back compatibility with earlier versions.

# What is in pacea?

Currently, pacea contains:

 - `r format(nrow(buoy_sst), big.mark = ",")` records of daily sea surface temperature measurements from
   `r nrow(buoy_metadata)` buoys.

 - outputs from the spatial British Columbia continental margin (BCCM) model
   - variables are:
     - dissolved oxygen concentration
	 - pH
	 - salinity
	 - temperature
	 - depth-integrated phytoplankton
	 - depth-integrated primary production
   - for applicable variables these are given for
     - sea surface
	 - sea bottom
	 - 0-40 m integration
     - 40-100 m integration
	 - 100 m to the bottom.
   - variables are for a total of 40,580 spatial cells across Canada's Pacific
     Exclusive Economic Zone
   - there are 27 years of monthly means, from 1993 to 2019

- NOAA's spatial Optimum Interpolation Sea Surface Temperature (OISST) record, that incorporates observations from different platforms (satellites,
     ships, buoys, and Argo floats).
   - OISST data are provided as 7-day and monthly means
   - from `r paste(lubridate::month(min(oisst_month$start_date), label = TRUE),
     lubridate::year(min(oisst_month$start_date)))` to `r paste(lubridate::month(max(oisst_month$start_date), label = TRUE),
     lubridate::year(max(oisst_month$start_date)))`.

- 9 climatic and oceanographic indices, such as the Pacific Decadal Oscillation
   and those related to El Ni単o

- estimates of abundances of Harbour Seals and Pacific Hake

# Brief examples of some questions that can be quickly investigated

**How does this year's sea surface temperature (red curve) in North Hecate Strait compare to previous
years, based on the buoy there?**
```{r northhecatetemp}
plot(buoy_sst, stn_id = "C46183")
```

**Are we entering a phase of El Ni単o, based on the Oceanic Ni単o Index? (If the
last bars are red, then 'yes')**
```{r oni}
plot(oni)
```

**How has the status of the Pacific Decadal Oscillation changed over time?**
```{r pdo}
plot(pdo)
```

**What were the differences in spatial pattern of sea surface temperature between June 2022 and 2023?**
```{r oisst}
plot(oisst_month, months.plot = "June", years.plot = c(2022, 2023))
```


<!-- See the vignettes (TODO link to rendered versions once we push them) for -->

# Installation

We are still developing pacea, and so it is not meant to be fully operational
yet (though it builds and can be used). We plan to release it in October 2023,
after which we will ensure back compatibility and give updates on the NEWS page.

To install the latest version:

```
install.packages("remotes")    # If you do not already have the "remotes" package

remotes::install_github("pbs-assess/pacea")
```

If you get an error like
```
Error in utils::download.file(....)
```
then the connection may be timing out (happens to us on the DFO network). Try

```
options(timeout = 1200)
```
and then try and install again. If you get a different error then contact Andy and Travis for help. If the R-CMD-check badge above does not say 'passing' in green, then just try again later as we've broken something and are probably trying to fix it. (Once we officially release pacea then we will ensure the installation always works - we'll work on another GitHub branch). You can try the option `build_vignettes = TRUE` if you like and look at the vignettes the usual way. Once we finalise the vignettes we will provide the `html` version on GitHub to be easily viewed.

</details>

------

STOP reading here - rest needs updating and is being modified.

<details>
  <summary>
    Collapsible heading
  </summary>
  This text should be hidden until user clicks on the arrow
</details>


TODO - rewrite all the following, giving some simple examples and referring to vignettes once we've finished those or Issues.

Currently, briefly (we will expand on this TODO) pacea includes output from a British Columbia ROMS (Regional Ocean Modeling System) model, climatic and oceanographic indices such as Pacific Decadal Oscillation, Pacific Hake stock assessment results, sea surface temperature from buoys, .... We do have context-specific plotting functions that relate to each type of data set.

TODO - give simple examples here, we're focussing on vignettes first....

Doing seals here then moving up to avoid conflict.

**What is the estimated abundance of Pacific Harbour Seals for each of seven regions?**
```{r sealplot}
plot(harbour_seals)
```

## Pacific Hake stock assessment results

Type these to see the values, help file, and then a plot:
```
library(pacea)

hake_recruitment              # estimated annual recruitment
?hake_recruitment
plot(hake_recruitment)

# Similar commands work for scaled versions:
hake_recruitment_over_2010    # see for details
?hake_recruitment_over_2010
plot(hake_recruitment_over_2010)

hake_recruitment_over_R0
?hake_recruitment_over_R0
plot(hake_recruitment_over_R0)

hake_biomass                  # estimated annual spawning stock biomass
?hake_biomass
# plot(biomass) not finished yet
```

## Climatic and oceanographic indices

See `?oni` etc. for descriptions. `plot(oni)` etc. somewhat work but not all default options are sensible yet. See `?plot.pacea_index`.
```
oni
pdo
soi
npi_monthly
npi_annual
```

# Audience and motivation

The primary audience is stock assessment scientists who want to analyse environmental variables in the context of their stock assessment. The Fisheries Act requires management of fisheries to take into account "[the biology of the fish and the environmental conditions affecting the stock](https://laws-lois.justice.gc.ca/eng/acts/f-14/page-3.html#h-1175547)". Such an Ecosystem Approach to Fisheries Management requires data.

A comprehensive [2022 analysis of Canadian stock assessments](https://publications.gc.ca/collections/collection_2022/mpo-dfo/Fs97-6-3473-eng.pdf) found that availability of data on environmental variables was the leading cause of not integrating such information into assessments. pacea aims to help make data availability more streamlined, and avoid each individual assessment scientist having to figure out themselves where to get appropriate data.

This work is strongly motivated by, and based on, the [GSLea](https://github.com/duplisea/gslea) R package by Dan Duplisea and colleagues for the Gulf of St Lawrence.


## Further data ideas (old - will move to Issue)

Charles: [SST and Chl-a summaries](https://bio-rsg.github.io/).

Several indices were extracted and analysed in Appendix F of a [Pacific Ocean Perch assessment](https://waves-vagues.dfo-mpo.gc.ca/Library/40803569.pdf). See that for links to websites. In the assessment we used:

- East-Pacific/North-Pacific index
- Pressure-adjusted sea level anomalies at Prince Rupert
- Standardized maximum area covered by Haida eddies
- Aleutian Low Pressure Index
- Standardized North Pacific Index
- Pacific Decadal Oscillation
- North Pacific Gyre Oscillation
- Oceanic Ni単o Index
- Southern Oscillation Index.
- Aleutian low pressure index


Following paper discusses how the Strait of Georgia transitions to Queen Charlotte Sound through Johnstone Strait.
It really makes the point that the separation is abrupt not gradual. And thus that somewhere about Chatham Point is a reasonable place to start the Northern Shelf Bioregion (and thus the marine component of the great bear rainforest):
Dosser, H.V., Waterman, S., Jackson, J.M., Hannah, C.G., Evans, W. and Hunt, B.P.V., [Stark physical and biogeochemical differences and implications for ecosystem stressors in the Northeast Pacific coastal ocean](https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2020JC017033
). Journal of Geophysical Research: Oceans, p.e2020JC017033.




## Funding

This work is funded by a Competitive Science Research Fund grant from Fisheries and Oceans Canada.



# For developers

Edit and render the README.Rmd file, not the README.Md file. If you add any new
figures then commit and push them (they will be in
man/figures/README-<chunk-name>) so they show up on the GitHub README. Always
render the .Rmd so that it and the rendered .Md stay in sync.

There is the option (haven't looked into yet) of using GitHub Actions to
re-render `README.Rmd` every time you push. An example workflow can be found
here: <https://github.com/r-lib/actions/tree/v1/examples>. But, it's generally best to
check things locally first before pushing.

Every data set is built using code in the `raw-data/` directory, with
documentation in `R/data.R`. Document everything!

If you add new functions please add tests as well so we retain good code
coverage.

Use the standard `lower_case_and_underscores` for naming
variables and functions.
