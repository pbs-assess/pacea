---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- build_readme() will build this when developing, but installs pacea from -->
<!-- scratch (and it might not be the local version) so it's much quicker to do -->
<!-- rmarkdown::render("README.Rmd"), which also builds an .html that can be -->
<!-- viewed locally (and isn't pushed to GitHub)  -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
#  cache=TRUE,  # want to try this
  fig.path = "man/figures/README-",
  out.width = "60%"
  )
library(ggplot2)    # TODO needed for harbour_seals plot - look into
```

# pacea <img src="man/figures/logo.png" align="right" height="138" />

<!-- badges: start -->
[![R-CMD-check](https://github.com/pbs-assess/pacea/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/pbs-assess/pacea/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/pbs-assess/pacea/branch/main/graph/badge.svg)](https://app.codecov.io/gh/pbs-assess/pacea?branch=main)
[![Visitors](https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fgithub.com%2Fpbs-assess%2Fpacea&label=VISITORS&countColor=%23263759&style=flat&labelStyle=lower)]
<!-- badges: end -->

An R package of Pacific ecosystem information to help facilitate an ecosystem approach to fisheries management

*We wrangle the data so you don't have to*

pacea stands for PACific Ecosystem Approach.

pacea is a data platform containing a variety of data
sets. We wrangle the data sets behind the scenes to get them into usable formats
in R, and provide helpful plotting functions. All data sets include
documentation regarding the original authors, who should be cited and consulted as
appropriate.

pacea will be released on 10th November 2023, and we are still developing and
editing it before then. So while you can download it before then, it might be
best to wait as we are still editing help files, vignettes, code, etc.
From 10th November we will document updates to data, new features, and any bug
fixes on the NEWS page. We will provide a plan for updating of certain data sets.

## What is in pacea?

Currently, pacea contains:

 - `r format(nrow(buoy_sst), big.mark = ",")` calculations of daily sea surface
   temperature based on data from `r nrow(buoy_metadata)` buoys.

 - outputs from the spatial British Columbia continental margin (BCCM) model, a coupled
   physical-biogeochemical model. Variables are for 40,580 spatial cells across Canada's Pacific
     Exclusive Economic Zone, and are given as 27 years of monthly means (from
   1993 to 2019). The variables are:
   - dissolved oxygen concentration
   - pH
   - salinity
   - temperature
   - depth-integrated phytoplankton
   - depth-integrated primary production.

   For applicable variables these are given for
   - sea surface
   - 0-40 m integration
   - 40-100 m integration
   - 100 m to the sea bottom
   - sea bottom.

- NOAA's spatial Optimum Interpolation Sea Surface Temperature (OISST) record, that incorporates observations from different platforms (satellites,
     ships, buoys, and Argo floats):
   - provided as weekly and monthly means from `r paste(lubridate::month(min(oisst_month$start_date), label = TRUE),
     lubridate::year(min(oisst_month$start_date)))` to `r paste(lubridate::month(max(oisst_month$start_date), label = TRUE),
     lubridate::year(max(oisst_month$start_date)))`.

- 9 climatic and oceanographic indices, such as the Pacific Decadal Oscillation
   and those related to El Niño.

- estimates of abundances of Harbour Seals and Pacific Hake.

Plotting and helper functions are provided, and demonstrated in vignettes.

## Brief examples of some questions that can be quickly investigated

**How does this year's sea surface temperature (red curve) in North Hecate Strait compare to previous
years, based on the buoy there?**
```{r northhecatetemp}
plot(buoy_sst, stn_id = "C46183")
```

**Are we entering a phase of El Niño, based on the Oceanic Niño Index? (If the
last bars are red, then 'yes')**
```{r oni}
plot(oni)
```

**How has the status of the Pacific Decadal Oscillation changed over time?**
```{r pdo}
plot(pdo)
```

**What were the differences in spatial pattern of sea surface temperature between June 2022 and 2023 (using OISST data)?**
```{r oisst}
plot(oisst_month, months.plot = "June", years.plot = c(2022, 2023))
```

**How did the upper 40m of dissolved oxygen differ between January and June, in 2015 (using BCCM ROMS output)?**
```{r bccm}
plot(bccm_avg0to40m_oxygen(force = TRUE), months.plot = c(1, 6), years.plot = 2015)
```

**What is the estimated abundance of Pacific Harbour Seals for each of seven regions?**
```{r sealplot}
plot(harbour_seals)
```

<!-- See the vignettes (TODO link to rendered versions once we push them) for -->

## Installation

To install the latest version:

```
install.packages("remotes")    # If you do not already have the "remotes" package

remotes::install_github("pbs-assess/pacea")
```

If you get an error like
```
Error in utils::download.file(....)
```
then the connection may be timing out (happens to us on the DFO network). Try

```
options(timeout = 1200)
```
and then try and install again. If you get a different error then contact Andy and Travis for help. If the R-CMD-check badge above does not say 'passing' in green, then just try again later as we've broken something and are probably trying to fix it. (Once we officially release pacea then we will ensure the installation always works - we'll work on another GitHub branch). You can try the option `build_vignettes = TRUE` if you like and look at the vignettes the usual way. Once we finalise the vignettes we will provide the `html` version on GitHub to be easily viewed.

</details>

TODO - rewrite all the following, giving some simple examples and referring to vignettes once we've finished those or Issues.

## Audience and motivation

The primary audience is stock assessment scientists who want to analyse environmental variables in the context of their stock assessment. The Fisheries Act requires management of fisheries to take into account "[the biology of the fish and the environmental conditions affecting the stock](https://laws-lois.justice.gc.ca/eng/acts/f-14/page-3.html#h-1175547)". Such an Ecosystem Approach to Fisheries Management requires data.

A comprehensive [2022 analysis of Canadian stock assessments](https://publications.gc.ca/collections/collection_2022/mpo-dfo/Fs97-6-3473-eng.pdf) found that availability of data on environmental variables was the leading cause of not integrating such information into assessments. pacea aims to help make data availability more streamlined, and avoid each individual assessment scientist having to figure out themselves where to get appropriate data.

This work is strongly motivated by, and based on, the [GSLea](https://github.com/duplisea/gslea) R package by Dan Duplisea and colleagues for the Gulf of St Lawrence.

## Acknowledgments

This work is funded by a Competitive Science Research Fund grant from Fisheries and Oceans Canada.
The pacea logo was expertly designed by Carley Colclough. TODO add
contributors.

## Notes for developers

TODO update

Edit and render the README.Rmd file, not the README.Md file. If you add any new
figures then commit and push them (they will be in
man/figures/README-<chunk-name>) so they show up on the GitHub README. Always
render the .Rmd so that it and the rendered .Md stay in sync.

There is the option (haven't looked into yet) of using GitHub Actions to
re-render `README.Rmd` every time you push. An example workflow can be found
here: <https://github.com/r-lib/actions/tree/v1/examples>. But, it's generally best to
check things locally first before pushing.

Every data set is built using code in the `raw-data/` directory, with
documentation in `R/data.R`. Document everything!

If you add new functions please add tests as well so we retain good code
coverage (as indicated in the badge at the top of the README on GitHub).

Use the standard `lower_case_and_underscores` for naming
variables and functions.

Citation information is in inst/CITATION, so if you update DESCRIPTION file
(e.g. add an author) then update that also, and may want to change info at the
start of this file.

Logo included by running `use_logo("inst/pacea-logo-from-carley.png")`. The .png was
expertly designed by Carley Colclough. There is also `inst/pacea-logo-for-printing.jpg`
for printing purposes.

<details open>
  <summary>
    Collapsible heading
  </summary>
  This text should be open and can be hidden. Prob best to just do TOC at top. TODO remove if not
  going to use.
</details>
